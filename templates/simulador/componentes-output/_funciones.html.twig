{% macro renderRafagaInicialData(rafagaInicial, memoria) %}
  {% import _self as this %}
  <div id="popover-flecha-0" class="popover-flecha" style="left: 24px;"></div>
  <div class="data-popover" id="propover-0" style="display: none;">
    <h3>Datos iniciales</h3>
    <div class="popover-body p-3">
      {% if rafagaInicial['cola_nuevos']|length %}
        <div class="cola nuevos">
          <div class="titulo">Cola de nuevos procesos</div>
          <div class="d-flex cola-body">
            {% for t, procesoNuevo in rafagaInicial['cola_nuevos'] %}
              <div
                {% if t is divisible by(2) %}
                  class="par"
                {% else %}
                  class="impar"
                {% endif %}
              >
                {{ procesoNuevo['id'] }}
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
      {% if rafagaInicial['cola_listos']|length %}
        <div class="cola listos">
          <div class="titulo">Cola de procesos listos</div>
          <div class="d-flex cola-body">
            {% for t, procesoNuevo in rafagaInicial['cola_listos'] %}
              <div
                {% if t is divisible by(2) %}
                  class="par"
                {% else %}
                  class="impar"
                {% endif %}
              >
                {{ procesoNuevo['id'] }}
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
      <div>
        {{ this.renderMemoria(0, rafagaInicial['particiones'], memoria, "Datos de la memoria") }}
      </div>
    </div>
  </div>
{% endmacro %}

{% macro renderRafagaData(t, rafagas, memoria) %}
  {% import _self as this %}
  {% set rafaga = rafagas[t] %}
  <div id="popover-flecha-{{ t + 1 }}" class="popover-flecha"></div>
  <div class="data-popover" id="propover-{{ t + 1 }}" style="display: none;">
    <h3>Datos de la rafaga {{ t+1 }}</h3>
    <div class="popover-body p-3">
      {% if rafaga['ejecuto'] %}
        <div>
          <span>Se ejecutó: </span>
          <span class="proceso-name">
              <strong>{{ rafaga['ejecuto']['id'] }}</strong>
          </span>
        </div>
      {% endif %}
      {% if rafaga['interrumpe'] is defined %}
        <div>
          <span>Se interrumpió: </span>
          <span class="proceso-name">
              <strong>{{ rafaga['interrumpe']['id'] }}</strong>
          </span>
        </div>
      {% endif %}
      {% if rafaga['bloqueo'] %}
        <div>
          <span>Se bloquea: </span>
          <span class="proceso-name">
              <strong>{{ rafaga['bloqueo']['id'] }}</strong>
          </span>
        </div>
      {% endif %}
      {% if rafaga['finalizo'] %}
        <div>
          <span>Finaliza: </span>
          <span class="proceso-name">
              <strong>{{ rafaga['finalizo']['id'] }}</strong>
          </span>
        </div>
      {% endif %}
      {% if rafaga['cola_nuevos']|length %}
        <div class="cola nuevos">
          <div class="titulo">Cola de nuevos procesos</div>
          <div class="d-flex cola-body">
            {% for t, procesoNuevo in rafaga['cola_nuevos'] %}
              <div
                {% if t is divisible by(2) %}
                  class="par"
                {% else %}
                  class="impar"
                {% endif %}
              >
                {{ procesoNuevo['id'] }}
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
      {% if rafaga['cola_listos']|length %}
        <div class="cola listos">
          <div class="titulo">Cola de procesos listos</div>
          <div class="d-flex cola-body">
            {% for t, procesoNuevo in rafaga['cola_listos'] %}
              <div
                {% if t is divisible by(2) %}
                  class="par"
                {% else %}
                  class="impar"
                {% endif %}
              >
                {{ procesoNuevo['id'] }}
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
      {% if rafaga['cola_bloqueados']|length %}
        <div class="cola bloqueados">
          <div class="titulo">Cola de procesos bloqueados</div>
          <div class="d-flex cola-body">
            {% for t, procesoNuevo in rafaga['cola_bloqueados'] %}
              <div
                {% if t is divisible by(2) %}
                  class="par"
                {% else %}
                  class="impar"
                {% endif %}
              >
                {{ procesoNuevo['id'] }}
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
      <div>
        {% if rafagas[t+1] is defined %}
          {% set rafagaSiguiente = rafagas[t+1] %}
          {{ this.renderMemoria(t, rafagaSiguiente['particiones'], memoria, "Datos de la memoria") }}
        {% endif %}
      </div>
    </div>
  </div>
{% endmacro %}

{% macro renderMemoria(t, particiones, memoria, titulo) %}
  {% set memoriaTotal = memoria.size %}
  {% set memoriaSO = memoria.soSize %}
  {% set memoriaUsuario = memoria.size - memoria.soSize %}
  {% set memoriaSOPercent = (memoriaSO * 100) / memoriaTotal %}
  {% set memoriaUsuarioPercent = (memoriaUsuario * 100) / memoriaTotal %}
  <div class="memoria-bloque">
    <div class="titulo">{{ titulo }}</div>
    <div class="p-3">
      <div class="particiones-container">
        <div class="particiones-usuario" style="height: {{ memoriaUsuarioPercent }}%">
          {% for particion in particiones %}
            {% set particionPercent = (particion['size'] * 100) / memoriaUsuario %}
            <div class="d-flex align-items-center particion-block" style="height: {{ particionPercent }}%">
              <div class="particion text-center"
                {% if particion['proceso_asignado'] or memoria.tipo == "fijas" %}
                  style="background-color:{{ particion['color'] }}; height: 100%;"
                {% endif %}
              >
                {% if particion['proceso_asignado'] %}
                  <div class="d-flex justify-content-center align-items-center h-100">
                    <div class="proceso-name">{{ particion['proceso_asignado']['id'] }}</div>
                  </div>
                {% else %}
                  <div class="particion-null"></div>
                {% endif %}
              </div>
              <div class="datos ml-1">
                <div class="d-flex flex-column justify-content-start align-items-center">
                  {% if particion['proceso_asignado'] or memoria.tipo == "fijas" %}
                    <div class="id"><strong>P{{ particion['id'] }}</strong></div>
                  {% endif %}
                  <div class="tamanio">{{ particion['size'] }}KB</div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        <div class="d-flex align-items-center particion-block so" style="height: {{ memoriaSOPercent }}%">
          <div class="particion so">
            <div class="d-flex justify-content-center align-items-center h-100">
              <div>S.O.</div>
            </div>
          </div>
          <div class="datos ml-1">
            <div class="d-flex flex-column justify-content-start align-items-center h-100">
              <div class="tamanio">
                {{ memoriaSO }}KB
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
{% endmacro %}